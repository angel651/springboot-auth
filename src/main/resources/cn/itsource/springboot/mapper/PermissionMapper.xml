<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.itsource.springboot.mapper.PermissionMapper">

    <resultMap id="resultPermission" type="Permission">
        <id column="id" property="id"/>
        <result column="name" property="name"/>
        <collection property="children" ofType="Permission">
            <id column="cid" property="id"/>
            <result column="cname" property="name"/>
        </collection>
    </resultMap>

    <!--查询所有的一级权限和二级权限-->
    <select id="loadLevlePermission" resultMap="resultPermission">
        select p.id,p.name,c.id cid,c.name cname from permission p LEFT JOIN permission c on p.id = c.parent_id
        where p.parent_id is null
    </select>

    <select id="loadPermissionidsByRoleId" resultType="long">
        SELECT p.id FROM role r
        JOIN role_permission rp ON r.id = rp.role_id
        JOIN permission p ON rp.permission_id = p.id
        WHERE r.id=#{roleId}
    </select>

    <select id="loadPermissionByUserid" resultType="string">
        SELECT p.url FROM employee e
        JOIN employee_role er ON e.id = er.employee_id
        JOIN role r ON er.role_id = r.id
        JOIN role_permission rp ON r.id = rp.role_id
        JOIN permission p ON rp.permission_id = p.id
        WHERE e.id=#{empid}
    </select>

    <select id="loadAllPermissionUrl" resultType="string">
        SELECT url FROM permission
    </select>
</mapper>